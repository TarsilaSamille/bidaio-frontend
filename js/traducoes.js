// --- DADOS DE TRADUÇÃO DA INTERFACE ---
const translations = {
    'pt': {
        'main_title': 'Tradutor Bidaio Jagoy',
        'main_subtitle': 'Plataforma de Tradução com IA • Edição de Dados em Tempo Real',
        'tab_translator': 'Tradutor',
        'tab_dictionary': 'Dicionário',
        'tab_corpus': 'Corpus',
        'tab_grammar': 'Gramática',
        'translate_title': 'Traduzir Texto',
        'placeholder_input': 'Digite seu texto em Português, Inglês ou Indonésio aqui...',
        'translate_button': 'Traduzir',
        'result_title': 'Resultado da Tradução',
        'confidence_label': 'Nível de Confiança',
        'bidaio_translation_label': 'Tradução em Bidaio',
        'correction_label': 'Sugerir Correção',
        'placeholder_correction': 'Se a tradução pode ser melhorada, por favor, sugira uma correção aqui...',
        'send_correction_button': 'Enviar Correção',
        'reasoning_summary': 'Análise da Tradução',
        'copy_button': 'Copiar',
        'download_button': 'Baixar',
        'examples_title': 'Exemplos Similares do Corpus',
        'examples_placeholder': 'Insira um texto e clique em "Traduzir" para visualizar exemplos relacionados.',
        'status_title': 'Status do Sistema',
        'status_dict': 'Dicionário:',
        'status_corpus': 'Corpus:',
        'status_grammar': 'Regras Gramaticais:',
        'status_api': 'API Status:',
        'download_all_button': 'Baixar Todos os Arquivos',
        'dict_title': 'Gerenciar Dicionário',
        'placeholder_dict_search': 'Buscar palavra no dicionário...',
        'download_json_button': 'Baixar JSON',
        'download_csv_button': 'Upload JSON',
        'loading_dict': 'Carregando dicionário...',
        'corpus_title': 'Gerenciar Corpus',
        'placeholder_corpus_search': 'Buscar frase no corpus...',
        'loading_corpus': 'Carregando corpus...',
        'grammar_title': 'Regras Gramaticais',
        'loading_grammar': 'Carregando regras gramaticais...',
        'current_lang_text': 'Português',
        'send_correction_button': 'Enviar Correção',
        'correction_sent': 'Correção Enviada!',
        'sending_correction': 'Enviando...',
        'correction_empty_error': 'O campo de correção não pode estar vazio.',
        'correction_send_error': 'Erro ao enviar correção.',
    },
    'en': {
        'main_title': 'Bidaio Jagoy Translator',
        'main_subtitle': 'AI Translation Platform • Real-time Data Editing',
        'tab_translator': 'Translator',
        'tab_dictionary': 'Dictionary',
        'tab_corpus': 'Corpus',
        'tab_grammar': 'Grammar',
        'translate_title': 'Translate Text',
        'placeholder_input': 'Enter your text in Portuguese, English, or Indonesian here...',
        'translate_button': 'Translate',
        'result_title': 'Translation Result',
        'confidence_label': 'Confidence Level',
        'bidaio_translation_label': 'Translation in Bidaio',
        'correction_label': 'Suggest Correction',
        'placeholder_correction': 'If the translation can be improved, please suggest a correction here...',
        'send_correction_button': 'Send Correction',
        'reasoning_summary': 'Translation Analysis',
        'copy_button': 'Copy',
        'download_button': 'Download',
        'examples_title': 'Similar Examples from Corpus',
        'examples_placeholder': 'Enter text and click "Translate" to view related examples.',
        'status_title': 'System Status',
        'status_dict': 'Dictionary:',
        'status_corpus': 'Corpus:',
        'status_grammar': 'Grammar Rules:',
        'status_api': 'API Status:',
        'download_all_button': 'Download All Files',
        'dict_title': 'Manage Dictionary',
        'placeholder_dict_search': 'Search for a word in the dictionary...',
        'download_json_button': 'Download JSON',
        'download_csv_button': 'Download CSV',
        'loading_dict': 'Loading dictionary...',
        'corpus_title': 'Manage Corpus',
        'placeholder_corpus_search': 'Search for a phrase in the corpus...',
        'loading_corpus': 'Loading corpus...',
        'grammar_title': 'Grammar Rules',
        'loading_grammar': 'Loading grammar rules...',
        'current_lang_text': 'English',
        'send_correction_button': 'Send Correction',
        'correction_sent': 'Correction Sent!',
        'sending_correction': 'Sending...',
        'correction_empty_error': 'The correction field cannot be empty.',
        'correction_send_error': 'Error sending correction.',
    },
    'id': {
        'main_title': 'Penerjemah Bidaio Jagoy',
        'main_subtitle': 'Platform Terjemahan AI • Pengeditan Data Real-time',
        'tab_translator': 'Penerjemah',
        'tab_dictionary': 'Kamus',
        'tab_corpus': 'Korpus',
        'tab_grammar': 'Tata Bahasa',
        'translate_title': 'Terjemahkan Teks',
        'placeholder_input': 'Masukkan teks Anda dalam Bahasa Portugis, Inggris, atau Indonesia di sini...',
        'translate_button': 'Terjemahkan',
        'result_title': 'Hasil Terjemahan',
        'confidence_label': 'Tingkat Keyakinan',
        'bidaio_translation_label': 'Terjemahan dalam Bidaio',
        'correction_label': 'Sarankan Koreksi',
        'placeholder_correction': 'Jika terjemahan dapat diperbaiki, silakan sarankan koreksi di sini...',
        'send_correction_button': 'Kirim Koreksi',
        'reasoning_summary': 'Analisis Terjemahan',
        'copy_button': 'Salin',
        'download_button': 'Unduh',
        'examples_title': 'Contoh Serupa dari Korpus',
        'examples_placeholder': 'Masukkan teks dan klik "Terjemahkan" untuk melihat contoh terkait.',
        'status_title': 'Status Sistem',
        'status_dict': 'Kamus:',
        'status_corpus': 'Korpus:',
        'status_grammar': 'Aturan Tata Bahasa:',
        'status_api': 'Status API:',
        'download_all_button': 'Unduh Semua File',
        'dict_title': 'Kelola Kamus',
        'placeholder_dict_search': 'Cari kata di kamus...',
        'download_json_button': 'Unduh JSON',
        'download_csv_button': 'Unduh CSV',
        'loading_dict': 'Memuat kamus...',
        'corpus_title': 'Kelola Korpus',
        'placeholder_corpus_search': 'Cari frasa di korpus...',
        'loading_corpus': 'Memuat korpus...',
        'grammar_title': 'Aturan Tata Bahasa',
        'loading_grammar': 'Memuat aturan tata bahasa...',
        'current_lang_text': 'Bahasa Indonesia',
        'send_correction_button': 'Kirim Koreksi',
        'correction_sent': 'Koreksi Terkirim!',
        'sending_correction': 'Mengirim...',
        'correction_empty_error': 'Kolom koreksi tidak boleh kosong.',
        'correction_send_error': 'Gagal mengirim koreksi.',
    }
};

let currentLanguage = 'en'; // Idioma padrão

// --- LÓGICA DO SELETOR DE IDIOMA ---
const langDropdown = document.getElementById('lang-dropdown');

function toggleLangDropdown() {
    langDropdown.classList.toggle('hidden');
}

function changeLanguage(lang) {
    event.preventDefault();
    currentLanguage = lang;
    const translationSet = translations[lang];

    document.querySelectorAll('[data-translate-key]').forEach(element => {
        const key = element.getAttribute('data-translate-key');
        if (translationSet[key]) {
            if (element.placeholder !== undefined) {
                element.placeholder = translationSet[key];
            } else {
                element.textContent = translationSet[key];
            }
        }
    });

    // Atualiza o texto do botão principal do seletor
    document.getElementById('current-lang-text').textContent = translationSet['current_lang_text'];

    // Fecha o dropdown após a seleção
    langDropdown.classList.add('hidden');
    document.documentElement.lang = lang.split('-')[0]; // Atualiza o atributo lang do HTML
}

// Fecha o dropdown se clicar fora dele
window.onclick = function (event) {
    if (!event.target.matches('#lang-selector-btn') && !event.target.closest('#lang-selector-btn')) {
        if (!langDropdown.classList.contains('hidden')) {
            langDropdown.classList.add('hidden');
        }
    }
}